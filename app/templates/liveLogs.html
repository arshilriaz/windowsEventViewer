<!DOCTYPE html>
<html>
<head>
    <title>Log Level Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            display: flex;
            flex-wrap: wrap;
        }
        .chart-container {
            flex: 1 1 50%; /* Take up 50% of the flex container's width */
            padding: 10px;
            box-sizing: border-box;
        }
        canvas {
            width: 90% !important; /* Full width of the container */
            height: 90% !important; /* Full height of the container, adjusted to maintain aspect ratio */
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <h2>Log Level Distribution</h2>
        <canvas id="logChart1"></canvas>
    </div>
    <!-- Need to complete this canva now -->
    <div class="chart-container">
        <h2>Logs Trend Distribution</h2>
        <canvas id="logChart2"></canvas>
    </div>

    <div class="chart-container">
        <h2>Another Graph Title</h2>
        <canvas id="logChart3"></canvas>
    </div>
    
    <div class="chart-container">
        <h2>Final Graph Title</h2>
        <canvas id="logChart4"></canvas>
    </div>

    <div id="formData" 
         data-hostname="{{ form_data['hostname'] }}"
         data-username="{{ form_data['username'] }}"
         data-password="{{ form_data['password'] }}"
         style="display:none;"></div>
         
    <script>
        var ctx = document.getElementById('logChart1').getContext('2d');
        var logChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Critical', 'Warning', 'Verbose', 'Error', 'Information'],
                datasets: [{
                    label: 'Number of Logs',
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Fetch the data attributes
        var formData = document.getElementById('formData');
        var hostname = formData.getAttribute('data-hostname');
        var username = formData.getAttribute('data-username');
        var password = formData.getAttribute('data-password');

        // Setup EventSource to listen for updates
        var eventSource = new EventSource('/liveLogs?hostname=' + hostname + '&username=' + username + '&password=' + password);
        eventSource.onmessage = function(event) {
            var data = JSON.parse(event.data);
            logChart.data.datasets[0].data = data.counts;  // Expecting 'counts' array
            logChart.update();
        };

    </script>
</body>
</html>
